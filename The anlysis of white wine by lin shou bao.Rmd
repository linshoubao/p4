# The anlysis of white wine by lin shou bao

========================================================

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
```

```{r echo=FALSE,warning=FALSE, Load_the_Data}
# 创建变量white_wine，将数据赋值到变量中
white_wine<-read.csv('C:/Users/linshoubao/Downloads/R/wineQualityWhites.csv')
dim(white_wine)  # 查看数据中的变量及观测值
str(white_wine)  # 查看数据结构
summary(white_wine)  #查看数据总结
```

在白葡萄酒数据集中，有13个变量，4898个观测值。

# Univariate Plots Section
```{r echo=FALSE, message=FALSE,Univariate_Plots}
#  查看固定酸度直方图
ggplot(aes(fixed.acidity),data=white_wine)+geom_histogram(color='white')
```

从固定酸度直方图，可以看出白葡萄酒固定酸度大部分集中6-8之间。

```{r echo=FALSE,message=FALSE,warning=FALSE}
# 查看挥发酸度直方图
ggplot(aes(volatile.acidity),data=white_wine)+geom_histogram(color='white')
summary(white_wine$volatile.acidity)
ggplot(aes(volatile.acidity),data=white_wine)+geom_histogram(binwidth = 0.01,color='white')
```

从挥发酸度直方图，可以看出白葡萄酒中挥发酸度大部分保持在0.2-0.4，0.9这里存在异常值，缩小组距后发现存在多个异常值。

```{r echo=FALSE,message=FALSE,warning=FALSE}
# 查看柠檬酸直方图
ggplot(aes(citric.acid),data=white_wine)+geom_histogram(color='white')
summary(white_wine$citric.acid)
```

柠檬酸主要集中在0.2-0.4之间,通过总结看出最大值1.66远超上四分位数0.39，存在异常值。

```{r echo=FALSE,message=FALSE,warning=FALSE}
# 创建新变量total.acidity
white_wine$total.acidity<-with(white_wine,fixed.acidity+citric.acid+volatile.acidity)
ggplot(aes(total.acidity),data=white_wine)+geom_histogram(binwidth = 0.1,color='white')
summary(white_wine$total.acidity)
```

大部分白葡萄酒总酸度集中在6-9。


```{r echo=FALSE,message=FALSE, warning=FALSE}
# 查看残糖直方图
ggplot(aes(residual.sugar),data=white_wine)+geom_histogram(color='white')
ggplot(aes(residual.sugar),data=white_wine)+geom_histogram(color='white')+scale_x_log10()
summary(white_wine$residual.sugar)
```

残糖维持在0-20之间，最大值为65.8，因此存在异常值。残糖取对数后，出现了双峰分布，说明残糖含量大部分集中在两个部分。

```{r echo=FALSE, message=FALSE,warning=FALSE}
# 查看氯化物含量直方图
ggplot(aes(chlorides),data=white_wine)+geom_histogram(color='white')
ggplot(aes(chlorides),data=white_wine)+geom_histogram(bins = 50,color='white')+
  scale_x_log10()
summary(white_wine$chlorides)
```

x轴数据取对数，转化的图像为正态分布。

```{r echo=FALSE,message=FALSE, warning=FALSE}
# 查看自由so2直方图
ggplot(aes(free.sulfur.dioxide),data=white_wine)+geom_histogram(bins=50,color='white')
summary(white_wine$free.sulfur.dioxide)
```

自由形式二氧化硫量主要集中在0-100之间，存在异常值。

```{r echo=FALSE,message=FALSE, warning=FALSE}
# 查看so2总量直方图
ggplot(aes(total.sulfur.dioxide),data=white_wine)+geom_histogram(bins=50,color='white')
summary(white_wine$total.sulfur.dioxide)
```

白葡萄酒中二氧化硫总量集中在100-200之间，存在异常值。

```{r echo=FALSE,message=FALSE, warning=FALSE}
# 查看密度直方图
ggplot(aes(density),data=white_wine)+geom_histogram(binwidth=0.0001)+
  scale_x_continuous(limits = c(0.98,1.049),breaks = seq(0.98,1.049,0.01))
summary(white_wine$density)
```

白葡萄酒密度变化非常小,集中在0.99-1.0之间，同时存在异常值。

```{r echo=FALSE,message=FALSE, warning=FALSE}
# 查看pH值直方图
ggplot(aes(pH),data=white_wine)+geom_histogram(color='white')
summary(white_wine$pH)
```

酒中pH值大部分在3-3.3之间。

```{r echo=FALSE,message=FALSE, warning=FALSE}
# 查看硫酸盐含量直方图
ggplot(aes(sulphates),data=white_wine)+geom_histogram(bins = 50,color='white')
summary(white_wine$sulphates)
```

酒中硫酸盐主要作用是生存so2,含量在0.4-0.6之间。

```{r echo=FALSE,message=FALSE, warning=FALSE}
# 查看酒精含量直方图
ggplot(aes(alcohol),data=white_wine)+geom_histogram(color='white')
summary(white_wine$alcohol)
```

酒中酒精含量在8%-14.2%之间。

```{r echo=FALSE,message=FALSE, warning=FALSE}
# 查看质量直方图
ggplot(aes(quality),data=white_wine)+geom_histogram()
summary(white_wine$quality)
table(white_wine$quality)
```

白葡萄酒质量普遍处于中等质量水平，极少数酒能达到高质量，说明白葡萄要做到高质量，难度比较大。


# Univariate Analysis

### What is the structure of your dataset?

1.数据集中有4898种白葡萄酒，每瓶酒有13个数据（x,fixed.acidity,volatile.acidity,citric.acid,residual.sugar,chlorides,free.sulfur.dioxide,
total.sulfur.dioxide,density,pH,sulphates,alcohol,quality）。其中变量quality中10分为最好，0分为最差。

2.volatile.acidity,citric.acid,residual.sugar,chlorides,free.sulfur.dioxide,total.sulfur.dioxide,density这7个变量中存在异常值。

3.酒精含量范围是8%-14.2%。

4.白葡萄酒质量最好为9分，最差为3分，其中大部分白葡萄酒是6分。

### What is/are the main feature(s) of interest in your dataset?

酒精（alcohol）和质量（quality）是最感兴趣的特征。

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

volatile.acidity,citric.acid,residual.sugar,alcohol,free.sulfur.dioxide等等都可能影响酒的质量。fixed.acidity和density可能影响最大。

### Did you create any new variables from existing variables in the dataset?

创建了总酸度变量total.acidity，下一步将探索总酸度变量是否与质量存在一种联系。

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

1.chlorides变量直方图呈现左偏斜分布，对该变量取平方根后呈现正态分布。

2.把所有酸度的变量相加起来，以总酸度的方式进行呈现。单个酸度可能对葡萄酒的质量影响不明显，但是总酸度对质量影响可能会很明显。

# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}
cor(white_wine[,2:14])
```

通过变量之间相关系数计算，alcohol与quality的相关性最大，其次是density、chlorides，但是他们的相关系数低于0.5，因此quality与单个特征相关不明显，而与多个特征会形成比较大的相关性。

```{r echo=FALSE, message=FALSE}
library(GGally)
library(memisc)
theme_set(theme_minimal(20))
white_wine_subset<-white_wine[,5:14]
ggpairs(white_wine_subset,axisLabels = 'internal') 
```

## 这是整个数据集中的部分变量之间的散点图矩阵图，下面我们将详细进行分析：
### （1）探索与质量存在相关性的变量。

```{r message=FALSE,echo=FALSE}
# 质量和酒精散点图
ggplot(aes(alcohol,quality),data = white_wine)+geom_jitter(alpha=0.1)+
  geom_smooth()

```


alcohlo和quality有一定的正相关关系，但是不是很明显，。

```{r echo=FALSE}
# 根据酒精含量划分为四个层次（7.5,9.5],(9.5,11.5],(11.5,13.5],(13.5,15.5]),创建新变量alcohol.ratio
white_wine$alcohol.ratio<-cut(white_wine$alcohol,c(7.5,9.5,11.5,13.5,15.5))
ggplot(aes(alcohol.ratio,quality),data=white_wine)+geom_boxplot()
by(white_wine$quality,white_wine$alcohol.ratio,summary)
```

从箱型图中可以看出，酒精含量越高的类别中，中位数也是越高，从侧面也说明了和质量的正相关关系。

```{r message=FALSE,echo=FALSE}
# 质量和密度散点图
ggplot(aes(density,quality),data=subset(white_wine,density<=quantile(white_wine$density,0.99)))+
  geom_point()
ggplot(aes(density,quality),data=subset(white_wine,density<=quantile(white_wine$density,0.99)))+
  geom_jitter(alpha=0.1)+
  geom_smooth()
  
```

第一张散点图过度绘制，第二张图采取了抖动和降低透明度，增加了平滑器，可以看出density和quality呈现负相关关系。

```{r message=FALSE,echo=FALSE}
# 质量和氯化物散点图
ggplot(aes(chlorides,quality),data=subset(white_wine,chlorides<=quantile(white_wine$chlorides,0.99)))+
  geom_point()
ggplot(aes(chlorides,quality),data=subset(white_wine,chlorides<=quantile(white_wine$chlorides,0.99)))+
  geom_jitter(alpha=0.1)+
  geom_smooth()
  
```

chlorides和quality也是一种负相关关系，效果依然不明显。


```{r message=FALSE,echo=FALSE}
# 总酸度和质量的散点图
ggplot(aes(total.acidity,quality),data = subset(white_wine,total.acidity<=quantile(white_wine$total.acidity,0.99)))+
  geom_point()
ggplot(aes(total.acidity,quality),data = subset(white_wine,total.acidity<=quantile(white_wine$total.acidity,0.99)))+
  geom_jitter(alpha=0.1)+
  geom_smooth()
```

total.acidity和quality有一种微弱的负相关关系。

```{r message=FALSE,echo=FALSE}
# so2总量和质量散点图
ggplot(aes(total.sulfur.dioxide,quality),data = subset(white_wine,total.acidity<=quantile(white_wine$total.sulfur.dioxide,0.99)))+
  geom_point()
ggplot(aes(total.sulfur.dioxide,quality),data = subset(white_wine,total.acidity<=quantile(white_wine$total.sulfur.dioxide,0.99)))+
  geom_jitter(alpha=0.1)+
  geom_smooth()
```

total.sulfur.dioxide和quality也是呈现一种微弱的负相关关系。

### （2）探索其他变量之间的关系。 

```{r message=FALSE,echo=FALSE}
ggplot(aes(free.sulfur.dioxide,total.sulfur.dioxide),data=white_wine)+geom_point(alpha=0.2)+
  coord_cartesian(xlim = c(0,150),ylim = c(0,400))+
  geom_smooth(method = 'lm')
```

因为total.sulfur.dioxide包含了free.sulfur.dioxide,所以这两个变量为存在正相关关系。

```{r echo=FALSE,message=FALSE,warning=FALSE}
ggplot(aes(fixed.acidity,pH),data = white_wine)+geom_jitter(alpha=0.1)+
  scale_x_continuous(limits = c(3,12))+
  geom_smooth()
ggplot(aes(volatile.acidity,pH),data = white_wine)+geom_jitter(alpha=0.1)
ggplot(aes(citric.acid,pH),data = white_wine)+geom_jitter(alpha=0.1)                                                          
```

对比上面三张图，可以看出pH值主要与固定酸度（fixed.acidity）有关，当然我们不能排除因为他们含量不在一个级别上。

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

1.除了alcohol，density、total.sulfur.dioxide、chlorides、total.acidity与quality是负相关关系。


### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

1.tolal.sulfur.dioxide与free.sulfur.dioxide呈现正相关关系，说明前者包含了后者。

2.pH值主要受到固定酸度（fixed.acidity）影响。

### What was the strongest relationship you found?

白葡萄酒质量关联最强的是alcohol。


# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}
# 探索密度、残糖量、酒精含量之间的关系
ggplot(aes(residual.sugar,density,color=alcohol.ratio),data=white_wine)+geom_jitter()+scale_color_brewer(type = 'div',guide = guide_legend(reverse = F))+
  coord_cartesian(xlim = c(0,30),ylim = c(0.985,1.01))

```

从这张图中更加直观的观察到：酒精含量越高，密度越小；残糖量越多，密度越大。

```{r message=FALSE,warning=FALSE,echo=FALSE}
# 探索酒精、质量、so2总量之间的关系
ggplot(aes(alcohol,quality,color=total.sulfur.dioxide),data = white_wine)+geom_point(alpha=0.5,position = 'jitter')+
  geom_smooth()
```

第三变量是连续变量，因此我们很难从多变量分析中，找出他们之间的关系。

```{r message=FALSE,warning=FALSE,echo=FALSE}
# 探索酒精、质量、总酸度之间的关系
ggplot(aes(alcohol,quality,color=total.acidity),data = white_wine)+
  geom_point(position = 'jitter',alpha=0.1)+
  geom_smooth()
  
```

同样的问题，很难发现第三变量与其他变量之间的关系。

```{r message=FALSE,warning=FALSE,echo=FALSE}
# 探索酒精、质量、氯化物之间的关系
ggplot(aes(alcohol,quality,color=chlorides),data = white_wine)+geom_point(position = 'jitter',alpha=0.1)+
  geom_smooth()
 
```

也是同样的问题。

```{r echo=FALSE}
 # 尝试计算线性回归模型
m1<-lm(I(quality)~I(alcohol),data = white_wine)
m2<-update(m1,~.+total.acidity)
m3<-update(m2,~.+chlorides)
m4<-update(m3,~.+total.sulfur.dioxide)
mtable(m1,m2,m3,m4)
```

从计算中，我们把与quality相关的变量加入了线性回归计算，但是得出的结果很惊讶，只能解释20%值的方差。

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

1.利用多变量分析，更加直观的刚看到密度和酒精、残糖量之间的关系。

2.没有发现相互之间可以加强的特征变量。

### Were there any interesting or surprising interactions between features?

1.density与residual.sugar保持正相关，与alcohol保持负相关。说明density本身就是因变量，值被其他值影响。

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE,warning=FALSE,message=FALSE, plot_One}
ggplot(aes(log10(residual.sugar)),data=white_wine)+geom_histogram(color='black',fill='blue')+
  scale_x_continuous(breaks = seq(-0.5,2.5,0.2))+
  labs(title='the Distribution of log10 residual sugar')
```

### Description One

对残糖量取对数后，发现直方图是双峰分布，可以看出数据集中残糖量主要集中在0.2和0.9附近。

### Plot Two
```{r echo=FALSE, message=FALSE, plot_Two}
ggplot(aes(alcohol,quality),data = white_wine)+geom_jitter(alpha=0.1,color='orange')+
  geom_smooth()+
  ggtitle('The plot of quality by alcohol')
```

### Description Two

酒精变量与质量变量是唯一的正相关关系，相关系数最大，其他变量都是负相关关系，且表现的很微弱。

### Plot Three
```{r echo=FALSE, Plot_Three}
ggplot(aes(residual.sugar,density,color=alcohol.ratio),data=white_wine)+geom_jitter()+
  scale_color_brewer(type = 'div',guide = guide_legend(reverse = F))+
  coord_cartesian(xlim = c(0,30),ylim = c(0.985,1.01))
```

### Description Three

通过相关关系计算，发现密度和质量维持一种负相关关系，但是密度和残糖量、酒精存在相关性。酒精含量越大，密度越小，然后酒精含量越大，质量越大。
因此我们可以发现密度和质量两个变量之间不存在相关性，酒精变量的作用导致出现了表面上的相关性。

------

# Reflection

1.我们发现酒中的酸度和pH的存在相关性，但是并不是特别显著。pH值反映的就是液体的酸碱度，应该会出现很大的相关性。
但是根据分析结果，有点惊讶，相关系数只有-0.43，一个原因可能是观测值只有4898个，偏少；另一个原因是异常值对结果的影响。

2.该数据集中，存在多个变量之间存在相关性，比如free.sulfur.dioxide和total.sulfur.dioxide，其中容易误导分析方向就是density,表面上和quality
存在相关性，其实不然。

3.数据集中，质量评分结果是根据人的感觉进行评分，存在主观因素，导致对最终的结果会有偏差。因此我们在建立线性回归模型的时候，难度很大，
最终没能完成有效的回归模型。




